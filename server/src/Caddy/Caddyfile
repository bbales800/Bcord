# Redirect plain HTTP for both hosts â†’ HTTPS (canonicalize to www)
http://b-cord.run.place, http://www.b-cord.run.place {
  redir https://www.b-cord.run.place{uri}
}

# Primary HTTPS site (both apex and www)
https://b-cord.run.place, https://www.b-cord.run.place {
  encode zstd gzip

  # ---- Static tester UI ----
  root * /srv/tester
  file_server

  # ---- WebSocket proxy to the C++ server ----
  @ws path /ws*
  reverse_proxy @ws bcord:9000

  # ---- Optional security headers ----
  header {
    Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    X-Content-Type-Options "nosniff"
    X-Frame-Options "DENY"
    Referrer-Policy "strict-origin-when-cross-origin"
  }

  # ---- Optional access log to stdout ----
  log {
    output stdout
    level INFO
  }
}
